# 数字简谱音乐生成器 (Digital Score Music Generator)

## 简介

本项目是基于 **MATLAB** 实现的一个数字信号处理（DSP）迷你项目，旨在通过计算机程序将数字简谱（Numbered Musical Notation）转换为可播放的音乐波形。项目核心是实现一个便捷的 **MATLAB App**，允许用户输入简谱、调整音乐参数（如调号、音色、衰减等），并实时生成和播放音乐。

本项目实现了从音乐理论到数字信号处理的完整流程，包括：

1.  **音符频率计算**: 基于十二平均律和调号规则，精确计算每个音符的基频。
2.  **波形合成**: 使用正弦波叠加（泛音）模拟不同乐器的音色，并应用指数衰减包络模拟真实的音量波动。
3.  **图形化界面**: 提供一个用户友好的 App 界面，简化乐谱输入和参数调整过程。

## 功能特性

*   **便捷的简谱输入**: 支持简化的字符串格式输入乐谱，如 `5. 6. 7. 1'' 7 6 5 4 3 4 5-`。
*   **参数化音乐生成**: 可自定义调号、采样频率、基础节拍、泛音系数和衰减率。
*   **音色模拟**: 通过调整泛音（谐波）系数，模拟不同乐器的音色。
*   **音量包络**: 应用指数衰减函数，使生成的音符更具真实感。
*   **实时波形显示**: 实时绘制生成的音乐波形图。
*   **播放与保存**: 支持直接在 App 中播放生成的音乐，并可导出为 `.wav` 格式文件。

## 快速开始

### 1. 环境要求

*   **MATLAB**: 建议使用较新版本（如 R2018b 或更高版本），以确保 App Designer 兼容性。

### 2. 文件结构

下载项目压缩包后，您将获得以下文件：

| 文件名 | 描述 |
| :--- | :--- |
| `MusicScoreApp.m` | MATLAB App Designer 的主代码文件（App 界面和逻辑）。 |
| `run_app.m` | 启动 App 的脚本。 |
| `tone2freq.m` | **核心函数**: 实现音符频率计算。 |
| `gen_wave.m` | **核心函数**: 实现单个音符波形生成（含泛音和衰减）。 |
| `gen_music.m` | **核心函数**: 整合简谱数据，生成完整音乐波形。 |
| `parse_score_string.m` | **辅助函数**: 解析用户输入的简谱字符串。 |
| `main_script.m` | 命令行测试脚本，用于演示核心函数的使用。 |

### 3. 运行 App

1.  将所有文件放置在您的 MATLAB 工作目录下。
2.  在 MATLAB 命令行窗口中输入并运行：
    ```matlab
    run_app
    ```
3.  App 界面将自动弹出。

## 简谱输入格式说明

为了实现便捷输入，本项目定义了一套简化的乐谱字符串格式。

| 符号 | 含义 | 示例 | 描述 |
| :--- | :--- | :--- | :--- |
| `1` - `7` | 数字音符 | `5` | 中音 G |
| `0` | 休止符 | `0` | 停顿 |
| `'` | 高八度 | `1'` | 高音 C |
| `''` | 高两个八度 | `1''` | 高高音 C |
| `,` | 低八度 | `5,` | 低音 G |
| `#` | 升半音 | `#4` | 升 F |
| `.` | 附点（延长 1/2 拍） | `5.` | 1.5 拍 |
| `-` | 增时线（延长 1 拍） | `5-` | 2 拍（二分音符） |
| `_` | 减时线（缩短 1/2 拍） | `5_` | 0.5 拍（八分音符） |

**示例乐谱输入：**

```
5. 6. 7. 1'' 7 6 5 4 3 4 5-
```

## 核心代码实现

### `tone2freq.m`

该函数实现了项目文档中要求的频率计算逻辑。它基于 **十二平均律** 原理，并考虑了调号、八度、升降调对频率的影响。

```matlab
function freq = tone2freq(tone, scale, noctave, rising)
% ...
    % 12平均律半音比率
    semitone_ratio = 2^(1/12);
    
    % 频率 = 基准音 '1' 的频率 * (半音比率 ^ 总半音数) * (2 ^ 八度数)
    freq = base_freq_1 * (semitone_ratio ^ total_semitones) * (2 ^ noctave);
end
```

### `gen_wave.m`

该函数负责生成单个音符的波形，并引入了两个关键的 DSP 概念：

1.  **泛音合成**: 通过叠加基频的整数倍谐波，并赋予不同的系数，来模拟不同乐器的音色。
2.  **指数衰减包络**: 应用 `y .* exp(-t * decay_rate)` 形式的衰减函数，使音符的振幅随时间自然衰减，模拟真实乐器演奏的听感。

## 贡献与致谢

本项目由 **Manus AI** 基于用户提供的 `Mini-Project.pdf` 需求文档完成。

## 许可证

本项目采用 [MIT License](LICENSE) 开放源代码。
